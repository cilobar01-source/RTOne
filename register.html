<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Daftar Akun · Portal RT Cilosari Barat</title>
<style>
body {font-family: Arial; background:#f6f8fa; display:flex; justify-content:center; align-items:center; height:100vh;}
.container {background:#fff; padding:25px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); width:90%; max-width:400px;}
input,button {width:100%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:5px;}
button {background:#0056b3; color:#fff; border:none; font-size:16px; cursor:pointer;}
button:hover {background:#003d80;}
</style>
</head>
<body>
  <div class="container">
    <h2>🪶 Daftar Akun RT Cilosari</h2>
    <form id="formDaftar">
      <input id="nama" type="text" placeholder="Nama Lengkap" required>
      <input id="email" type="email" placeholder="Alamat Email" required>
      <input id="password" type="password" placeholder="Kata Sandi (min. 6 karakter)" minlength="6" required>
      <button type="submit">Daftar</button>
    </form>
    <p id="status" style="text-align:center;color:#555;"></p>
  </div>

<script type="module">
import { app, auth, db } from "./script.js";
import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
import { doc, setDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

const form = document.getElementById("formDaftar");
const status = document.getElementById("status");

form.addEventListener("submit", async (e)=>{
  e.preventDefault();
  const nama = document.getElementById("nama").value.trim();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();

  status.innerText = "⏳ Mendaftar...";

  try {
    // 🔹 Buat akun di Authentication
    const userCred = await createUserWithEmailAndPassword(auth, email, password);
    const uid = userCred.user.uid;

    // 🔹 Simpan ke Firestore
    await setDoc(doc(db, "profiles", uid), {
      nama,
      email,
      role: "WARGA",
      createdAt: new Date().toISOString()
    });

    status.innerText = "✅ Pendaftaran berhasil!";
    setTimeout(()=>window.location.href="login.html",1500);
  } catch (err) {
    console.error(err);
    status.innerText = "❌ Gagal daftar: " + err.message;
  }
});
</script>
</body>
</html>
