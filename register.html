<script type="module">
  import { auth, db } from "./script.js";
  import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
  import { doc, setDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

  const form = document.getElementById("registerForm");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const nama = form.nama.value.trim();
    const email = form.email.value.trim();
    const password = form.password.value.trim();

    try {
      const userCred = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCred.user;

      // Simpan ke Firestore
      await setDoc(doc(db, "profiles", user.uid), {
        nama,
        email,
        role: "WARGA",
        createdAt: new Date()
      });

      alert("✅ Pendaftaran berhasil! Silakan login.");
      window.location.href = "login.html";
    } catch (err) {
      alert("❌ Gagal daftar: " + err.message);
      console.error(err);
    }
  });
</script>
